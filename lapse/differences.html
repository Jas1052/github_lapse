<del>&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;link rel='shortcut icon' href='../../www/img/favicon.ico' type='image/x-icon'/&gt;&lt;/head&gt;&lt;body style='width:100%;height:100%;background-color:white;'&gt;&lt;div style='font-family:Segoe UI;color:blue;font-size:50px;position:absolute;top:0;left:15px;'&gt;2&lt;/div&gt;&lt;div style='align-items:center;justify-content:center;'&gt;&lt;pre&gt;# Acai</del><br><ins>&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;link rel='shortcut icon' href='../../www/img/favicon.ico' type='image/x-icon'/&gt;&lt;/head&gt;&lt;body style='width:100%;height:100%;background-color:white;'&gt;&lt;div style='font-family:Segoe UI;color:blue;font-size:50px;position:absolute;top:0;left:15px;'&gt;3&lt;/div&gt;&lt;div style='align-items:center;justify-content:center;'&gt;&lt;pre&gt;# Acai</ins><br><span></span><br><span>Disclaimer: This is not an official Google product.</span><br><span></span><br><span>Acai makes it easy to write functional tests of your application</span><br><span>with JUnit4 and Guice.</span><br><span></span><br><span>Acai makes it simple to:</span><br><span> - Inject the helper classes you need into tests</span><br><span> - Start any services needed by your tests</span><br><span> - Run between-test cleanup of these services</span><br><span> - Start up multiple services for testing in the right order</span><br><span></span><br><span>Acai is designed for large functional tests of your application. For</span><br><span>example it can help with writing tests which start your backend and frontend</span><br><span>server in a self-contained mode with their dependencies faked out and then</span><br><span>validates some key user scenarios with Webdriver to give you confidence your</span><br><span>complete system works correctly. It can also be useful for tests which validate</span><br><span>the integration of a small set of components. Note however that for smaller</span><br><span>unit-tests we generally recommend you create the class under test manually</span><br><span>rather than using Acai.</span><br><span></span><br><span>## Using Acai to inject a test</span><br><span>The simplest test using Acai doesn't register any TestingService bindings</span><br><span>at all, it just uses Acai to inject a test with a module:</span><br><span></span><br><span>```Java</span><br><span>@RunWith(JUnit4.class)</span><br><span>public class SimpleTest {</span><br><span>  @Rule public Acai acai = new Acai(MyTestModule.class);</span><br><span></span><br><span>  @Inject private MyClass foo;</span><br><span></span><br><span>  @Test</span><br><span>  public void checkSomethingWorks() {</span><br><span>    // Use the injected value of foo here</span><br><span>  }</span><br><span></span><br><span>  private static class MyTestModule extends AbstractModule {</span><br><span>    @Override protected void configure() {</span><br><span>      bind(MyClass.class).to(MyClassImpl.class);</span><br><span>    }</span><br><span>  }</span><br><span>}</span><br><span>```</span><br><span></span><br><span>## Using Acai to start services</span><br><span>The real power of Acai comes when your production server is configured</span><br><span>with Guice and you create an alternate test module which configures your server</span><br><span>with heavyweight dependencies like databases replaced with local in-memory</span><br><span>implementations. You could then start this server once for all tests in the</span><br><span>suite (to avoid waiting for it to start between each test) and wipe the</span><br><span>database between tests (to cheaply isolate test-cases from one-another).</span><br><span></span><br><span>The following example shows how this pattern would be used in tests:</span><br><span></span><br><span>```Java</span><br><span>@RunWith(JUnit4.class)</span><br><span>public class ExampleFunctionalTest {</span><br><span>  @Rule public Acai acai = new Acai(MyTestModule.class);</span><br><span></span><br><span>  @Inject private MyServerClient serverClient;</span><br><span></span><br><span>  @Test</span><br><span>  public void checkSomethingWorks() {</span><br><span>    // Call the running server and test some behaviour here.</span><br><span>    // Any state will be cleared by MyFakeDatabaseWiper after each</span><br><span>    // test case.</span><br><span>  }</span><br><span></span><br><span>  private static class MyTestModule extends AbstractModule {</span><br><span>    @Override protected void configure() {</span><br><span>      // Normal Guice modules which configure your</span><br><span>      // server with in-memory versions of backends.</span><br><span>      install(MyServerModule());</span><br><span>      install(MyFakeDatabaseModule());</span><br><span></span><br><span>      install(new TestingServiceModule() {</span><br><span>        @Override protected void configureTestingServices() {</span><br><span>          bindTestingService(MyServerRunner.class);</span><br><span>          bindTestingService(MyFakeDatabaseWiper.class);</span><br><span>        }</span><br><span>      });</span><br><span>    }</span><br><span>  }</span><br><span></span><br><span>  private static class MyServerRunner implements TestingService {</span><br><span>    @Inject private MyServer myServer;</span><br><span></span><br><span>    @BeforeSuite public void startServer() {</span><br><span>      myServer.start().awaitStarted();</span><br><span>    }</span><br><span>  }</span><br><span></span><br><span>  private static class MyFakeDatabaseWiper implements TestingService {</span><br><span>    @Inject private MyFakeDatabse myFakeDatabase;</span><br><span></span><br><span>    @AfterTest public void wipeDatabase() {</span><br><span>      myFakeDatabase.wipe();</span><br><span>    }</span><br><span>  }</span><br><span>}</span><br><span>```</span><br><span></span><br><span>Note that when a module is passed to Acai in a rule any @BeforeSuite</span><br><span>methods are only executed once per suite even if the same module is used in</span><br><span>multiple Acai rules in multiple different test classes within that suite.</span><br><span>This allows tests of the server to be structured into test classes according to</span><br><span>the functionality being tested.</span><br><span></span><br><span>## Services which depend upon each other</span><br><span>If the services you need to start for tests must be started in a specific order</span><br><span>you can express this using the `@DependsOn` annotation.</span><br><span></span><br><span>For example:</span><br><span></span><br><span>```Java</span><br><span>@RunWith(JUnit4.class)</span><br><span>public class ExampleFrontendWebdriverTest {</span><br><span>  @Rule public Acai acai = new Acai(MyTestModule.class);</span><br><span></span><br><span>  @Inject private SomeFrontendFeaturePageObject featurePage;</span><br><span></span><br><span>  @Test</span><br><span>  public void checkSomethingWorks() {</span><br><span>    // Test the frontend client using the webdriver page</span><br><span>    // object here.</span><br><span>  }</span><br><span></span><br><span>  private static class MyTestModule extends AbstractModule {</span><br><span>    @Override protected void configure() {</span><br><span>      // Normal Guice modules which configure your</span><br><span>      // server with in-memory versions of servers and</span><br><span>      // a test module configuring a webdriver client.</span><br><span>      install(MyServerModule());</span><br><span>      install(MyFakeDatabaseModule());</span><br><span>      install(WebDriverModule());</span><br><span></span><br><span>      install(new TestingServiceModule() {</span><br><span>        @Override protected void configureTestingServices() {</span><br><span>          bindTestingService(MyServerRunner.class);</span><br><span>          bindTestingService(MyBackendRunner.class);</span><br><span>        }</span><br><span>      });</span><br><span>    }</span><br><span>  }</span><br><span></span><br><span>  @DependsOn(MyBackendRunner.class)</span><br><span>  private static class MyFrontendRunner implements TestingService {</span><br><span>    @Inject private MyFrontendServer myFrontendServer;</span><br><span></span><br><span>    @BeforeSuite public void startServer() {</span><br><span>      myFrontendServer.start().awaitStarted();</span><br><span>    }</span><br><span>  }</span><br><span></span><br><span>  private static class MyBackendRunner implements TestingService {</span><br><span>    @Inject private MyBackendServer myBackendServer;</span><br><span></span><br><span>    @BeforeSuite public void startServer() {</span><br><span>      myBackendServer.start().awaitStarted();</span><br><span>    }</span><br><span>  }</span><br><span>}</span><br><span>```</span><br><span></span><br><span>In the above example `MyFrontendRunner` is annotated</span><br><span>`@DependsOn(MyBackendRunner.class)` which will cause Acai to start the</span><br><span>backend server before starting the frontend.</span><br><span></span><br><span>## API</span><br><span>As shown in the above examples Acai has a very small API surface.</span><br><span>Firstly, and most importantly, there is the `Acai` rule class itself</span><br><span>which is used as a JUnit4 `@Rule` and is passed a module class to be used to</span><br><span>configure the test.</span><br><span></span><br><span>The module class passed to the `Acai` constructor may optionally use</span><br><span>`TestingServiceModule` to bind one or more `TestingService` implementations.</span><br><span></span><br><span>The `TestingService` interface is purely a marker to allow Acai to know</span><br><span>which classes provide testing services. To actually do anything implementations</span><br><span>of this interface should add zero argument methods annotated with one of</span><br><span>`@BeforeSuite`, `@BeforeTest` or `@AfterTest`. These methods will be run before</span><br><span>the suite, before each test or after each test respectively. You may add as</span><br><span>many methods annotated with these annotations as you wish to a</span><br><span>`TestingService`; Acai will find and run them all when appropriate.</span><br><span></span><br><span>Finally a `TestingService` implementation can be annotated `@DependsOn` to</span><br><span>signal its `@BeforeSuite` and `@BeforeTest` methods need to be run after</span><br><span>those of another `TestingService`. This provides a simple declarative mechanism</span><br><span>to order service startup in tests.</span><br><span></span><br><span>Refer to the examples above to see the API in action.</span><br><span>&lt;/pre&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;</span><br><span>&lt;script src='https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js'&gt;&lt;/script&gt;</span><br><span>&lt;script&gt;</span><br><span>    document.onkeydown = checkKey;</span><br><span>    function checkKey(e) {</span><br><span>        e = e || window.event;</span><br><span>      if (e.keyCode == '37') {</span><br><span>          var fileName = location.href.split('/').slice(-1); </span><br><span>          fileName = fileName.toString();</span><br><span>          var dotIndex = fileName.indexOf('.');</span><br><span>          fileCount = fileName.substring(5, dotIndex);</span><br><span>          var count = parseInt(fileCount);</span><br><span>          count--;</span><br><span>          if(count&gt;0){</span><br><span>            document.location.href = 'frame' + count + '.html';</span><br><span>         }</span><br><span>        }</span><br><span>        else if (e.keyCode == '39') {</span><br><span>           // right arrow</span><br><span>           var fileName = location.href.split('/').slice(-1); </span><br><span>           fileName = fileName.toString();</span><br><span>           var dotIndex = fileName.indexOf('.');</span><br><span>           fileCount = fileName.substring(5, dotIndex);</span><br><span>           var count = parseInt(fileCount);</span><br><span>           count++;</span><br><span>          $.get('frame'+count+'.html')</span><br><span>            .done(function() { </span><br><span>              document.location.href = 'frame' + count + '.html';</span><br><span>            }).fail(function() { </span><br><span>                  // not exists code</span><br><span>            })</span><br><span>          }</span><br><span>      }</span><br><span></span><br><span>    &lt;/script&gt;</span><br>